var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,r){function o(e){try{s(n.next(e))}catch(t){r(t)}}function d(e){try{s(n["throw"](e))}catch(t){r(t)}}function s(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(o,d)}s((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(o=s.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(n){i=[6,n],r=0}finally{a=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,r,o,d,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return d={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d},Scene=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.initScene,t),t.addEventListener(egret.Event.REMOVED_FROM_STAGE,t.release,t),t}return __extends(t,e),t.prototype.initScene=function(){egret.TextField.default_fontFamily="MyFont",this.init()},t.prototype.init=function(){},t.prototype.release=function(){},t.prototype.center=function(e,t){return void 0===t&&(t=this.stage.stageWidth),(t-e.width)/2},t}(eui.UILayer);__reflect(Scene.prototype,"Scene");var Task=function(e){function t(t){var i=e.call(this)||this;return i.init(t),i}return __extends(t,e),t.prototype.init=function(e){var t=this,i=ViewManager.getInstance().stage;this.width=i.stageWidth,this.height=i.stageHeight;var n=Util.createBitmapByName("info_doc");n.x=(this.width-n.width)/2,n.y=220,this.addChild(n);var a=Util.setTitle("今日任务",60,Config.COLOR_DOC);a.x=(this.width-a.width)/2,a.y=280,this.addChild(a);var r=new BtnBase("close");r.x=i.stageWidth-r.width-68,r.y=246,this.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.parent.removeChild(t),1==e.level_id&&Http.getInstance().get(Url.HTTP_USER_INFO,function(e){if(e.data.isUpdate){var t=new GetVbaoScene(e.data.kind_id-1,2);ViewManager.getInstance().changeScene(t)}})},this),Http.getInstance().get(Url.HTTP_TASK_TASKLIST,function(n){var a,r=400;n.data.forEach(function(n){switch(n.id){case 1:a=function(){Http.getInstance().post(Url.HTTP_TASK_FINISHTASK,{taskId:n.id,score:n.score},function(e){e.data.code&&Http.getInstance().get(Url.HTTP_LEGENDARY,function(e){location.href=e.data.content,t.removeChild(t.$children[4]),t.$children.forEach(function(e,t){t>3&&(e.y-=210)})})})};break;case 3:a=function(){var e=new WishScene(n);ViewManager.getInstance().changeScene(e)};break;case 4:a=function(){var i=JSON.parse(window.localStorage.getItem("foodList"));Http.getInstance().get(Url.HTTP_USER_SIGN,function(){i=i.map(function(e,i){e.num+=1;var n=t.parent.getChildByName("head").$children[2].$children[i+1].$children[2];return n.textFlow=[{text:"X",style:{size:20}},{text:"  "+e.num,style:{size:24}}],e}),window.localStorage.setItem("foodList",JSON.stringify(i));var n=t.parent.$children[0].$children[1];n.text="积分："+(e.total_score+1),t.removeChild(t.$children[4]),t.$children.forEach(function(e,t){t>3&&(e.y-=150)})})};break;case 5:a=function(){t.parent.getChildByName("feed").dispatchEventWith(egret.TouchEvent.TOUCH_TAP),t.parent.removeChild(t)};break;case 6:a=function(){t.parent.getChildByName("around").dispatchEventWith(egret.TouchEvent.TOUCH_TAP),t.parent.removeChild(t)}}if(!n.taskStatus){var o=t.taskList(n,a);o.x=(i.stageWidth-o.width)/2,o.y=r,t.addChild(o),r+=o.height+30}})});var o=new egret.TextField;o.text="完成每个任务都能增加积分哦。那积分可以做什么呢？你猜呀~",o.width=510,o.x=(i.stageWidth-o.width)/2,o.y=1060,o.textAlign="center",o.lineSpacing=25,o.bold=!0,this.addChild(o)},t.prototype.taskList=function(e,t){var i=new eui.Group,n=Util.drawRoundRect(0,16777215,16777215,580,3==e.id?280:4==e.id?120:190,40);i.width=n.width,i.height=n.height,i.addChild(n);var a=Util.createBitmapByName("flag");a.x=30,a.y=30,i.addChild(a);var r=new egret.TextField;if(r.text=e.name,r.size=38,r.textColor=2181982,r.x=105,r.y=30,i.addChild(r),3==e.id){var o=new egret.TextField;o.text="小宝宝总在眨眼间就长大了。不信？试\n着给V宝发送一个祝福吧！",o.x=a.x,o.y=88,o.textAlign="center",o.textColor=Config.COLOR_DOC,o.lineSpacing=6,i.addChild(o)}var d=new egret.TextField;d.textColor=r.textColor,d.size=r.size,d.x=205,d.y=r.y,5==e.id?d.text="("+e.resultCount+"/"+e.taskCount+")":6==e.id&&(d.text="X"+(e.taskCount-e.resultCount)),i.addChild(d);var s=new egret.TextField;s.text="+"+e.score+"积分",s.textColor=1603534,s.size=24,s.x=4==e.id?200:450,s.y=r.y,s.height=r.height,s.verticalAlign="middle",i.addChild(s);var h=new BtnBase(4==e.id?"btn_sign":"btn_go");return h.x=4==e.id?422:(i.width-h.width)/2,h.y=3==e.id?175:4==e.id?16:98,i.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,t,this),i},t}(eui.Group);__reflect(Task.prototype,"Task");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),ViewManager.getInstance().stage=this.stage,e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return i.sent(),this.stage.removeChild(e),egret.registerFontMapping("MyFont","resource/MyFont.ttf"),[3,4];case 3:return t=i.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){var e={},t=location.search.slice(1).split("&");t.forEach(function(t){e[t.split("=")[0]]=t.split("=")[1]});var i=JSON.parse(window.localStorage.getItem("userInfo"));if(e.inviteId){var n=location.href.split("?")[0];history.replaceState({},"",n);var a=new FriendHomeScene(i.id,e.inviteId);ViewManager.getInstance().changeScene(a)}else{var r=0==i.level_id?new KindScene:new IndexScene;ViewManager.getInstance().changeScene(r)}},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ViewManager=function(){function e(){this.views=[],this.bones={}}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.getCurrentScene=function(){var e=this.views.length;return 0===e?null:this.views[e-1]},e.prototype.changeScene=function(e){if(!e)return void console.error("场景不能为空！");var t=this.getCurrentScene();t&&egret.Tween.get(t).to({alpha:1},10).wait(10).to({alpha:0},100).call(function(){t.parent.removeChild(t)},this),this.stage.addChild(e),this.views.push(e)},e.prototype.back=function(e){var t=this;void 0===e&&(e=1);var i=this.views.length;if(i>e){var n=this.views[i-1],a=this.views[i-e-1],r=egret.Tween.get(n);r.to({alpha:0},100),r.wait(50),r.call(function(){n&&n.parent&&n.parent.removeChild(n),t.stage.addChild(a);var i=egret.Tween.get(a);i.to({alpha:1},100);for(var r=0;e>r;r++)t.views.pop()},this)}},e.prototype.getBones=function(e){return this.bones[e]},e.prototype.setBones=function(e,t){this.bones[e]=t},e}();__reflect(ViewManager.prototype,"ViewManager");var Alert=function(e){function t(t,i){void 0===i&&(i="right");var n=e.call(this)||this;return n.init(t,i),n}return __extends(t,e),t.prototype.init=function(e,t){var i=new egret.TextField;i.text=e,i.width=180,i.size=22,i.lineSpacing=16;var n=Util.drawRoundRect(0,0,0,240,i.height+40,20,.6);this.addChild(n),i.x=28,i.y=20,this.addChild(i);var a=Util.createBitmapByName("tail_"+t);a.x="right"==t?212:5,a.y=n.height,this.addChild(a)},t}(egret.DisplayObjectContainer);__reflect(Alert.prototype,"Alert");var GiftTip=function(e){function t(t){var i=e.call(this)||this;return i.init(t),i}return __extends(t,e),t.prototype.init=function(e){var t=Util.drawRoundRect(0,0,0,300,80,20,.6);this.addChild(t);var i=new egret.TextField;i.text="恭喜你获得",i.size=22,i.x=28,i.y=30,this.addChild(i);var n=Util.createBitmapByName(e);n.x=i.x+i.width+10,n.y=i.y-20,this.addChild(n);var a=new egret.TextField;a.text="X 1",i.size=22,a.x=n.x+n.width+10,a.y=i.y,this.addChild(a);var r=Util.createBitmapByName("tail_left");r.x=5,r.y=t.height,this.addChild(r)},t}(egret.DisplayObjectContainer);__reflect(GiftTip.prototype,"GiftTip");var Bones=function(e){function t(t,i,n,a){var r=e.call(this)||this;return r.init(t,i,n,a),r}return __extends(t,e),t.prototype.init=function(e,t,i,n){var a=["doc","box","pilot"],r=RES.getRes(""+a[e]+t+"_ske"),o=RES.getRes(""+a[e]+t+"_tex"),d=RES.getRes(""+a[e]+t+"_tex_png"),s=ViewManager.getInstance().getBones(""+e+t);if(s)return s.x=i,s.y=n,void this.addChild(s);var h=dragonBones.EgretFactory.factory;h.parseDragonBonesData(r),h.parseTextureAtlasData(o,d);var l=h.buildArmatureDisplay(""+a[e]+t+"Armature");this.addChild(l),l.x=i,l.y=n;var c=1==t?.4:.25;l.scaleX=c,l.scaleY=c,l.animation.play("newAnimation"),ViewManager.getInstance().setBones(""+e+t,l)},t}(egret.DisplayObjectContainer);__reflect(Bones.prototype,"Bones");var BtnBase=function(e){function t(t){var i=e.call(this)||this;return i.init(t),i}return __extends(t,e),t.prototype.init=function(e){var t=new egret.Bitmap,i=RES.getRes(e);t.texture=i,t.touchEnabled=!0,this.addChild(t),this.width=t.width,this.height=t.height,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.texture=RES.getRes(e+"_down")},this),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.texture=RES.getRes(e)},this)},t}(egret.DisplayObjectContainer);__reflect(BtnBase.prototype,"BtnBase");var Head=function(e){function t(t){var i=e.call(this)||this;return i.init(t),i}return __extends(t,e),t.prototype.init=function(e){var t=Util.setAvatar(e.avatar);t.x=30,t.y=45,this.addChild(t),this.name="head";var i=new egret.TextField;i.text="积分："+e.total_score,i.x=200,i.y=1==e.level_id?100:150,i.size=24,i.bold=!0,i.strokeColor=Config.COLOR_DOC,i.stroke=1,this.addChild(i),this.score=i},t.prototype.food_list=function(e){var t=this,i=[{name:"V宝典",image:"icon_dir",num:e.v_bfood},{name:"V拳套",image:"icon_glove",num:e.v_tfood},{name:"V飞机",image:"icon_air",num:e.v_ffood}];window.localStorage.setItem("foodList",JSON.stringify(i));var n=new eui.Group;n.x=180,n.y=48,this.header_group=n,this.addChild(n);var a=Util.createBitmapByName("header_bg");n.width=a.width,n.height=a.height,n.addChild(a);var r=30;i.forEach(function(e){var i=t.food(e.image,e.name,e.num);i.x=r,i.y=16,n.addChild(i),r+=i.width})},t.prototype.food=function(e,t,i){var n=new eui.Group;n.width=170;var a=Util.createBitmapByName(e);n.addChild(a);var r=Util.setTitle(t,18,Config.COLOR_DOC);r.x=a.width+8,r.y=8,r.fontFamily="dynamic",n.addChild(r);var o=new egret.TextField;return o.textFlow=[{text:"X",style:{size:20}},{text:"  "+i,style:{size:24}}],o.strokeColor=Config.COLOR_DOC,o.stroke=2,o.x=r.x,o.y=r.y+r.height+6,o.fontFamily="dynamic",n.addChild(o),n},t}(egret.DisplayObjectContainer);__reflect(Head.prototype,"Head");var MyMovieClip=function(e){function t(t,i){void 0===i&&(i=-1);var n=e.call(this)||this;return n.aniName=t,n.playTimes=i,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(e){this.load(this.initMovieClip)},t.prototype.initMovieClip=function(){var e=new egret.MovieClipDataFactory(this._mcData,this._mcTexture),t=new egret.MovieClip(e.generateMovieClipData(this.aniName));this.addChild(t),t.gotoAndPlay(1,this.playTimes)},t.prototype.load=function(e){function t(){i++,2==i&&e.call(n)}var i=0,n=this,a=new egret.URLLoader;a.addEventListener(egret.Event.COMPLETE,function(e){var i=e.currentTarget;this._mcTexture=i.data,t()},this),a.dataFormat=egret.URLLoaderDataFormat.TEXTURE;var r=new egret.URLRequest("resource/assets/"+this.aniName+".png");a.load(r);var a=new egret.URLLoader;a.addEventListener(egret.Event.COMPLETE,function(e){var i=e.currentTarget;this._mcData=JSON.parse(i.data),t()},this),a.dataFormat=egret.URLLoaderDataFormat.TEXT;var r=new egret.URLRequest("resource/assets/"+this.aniName+".json");a.load(r)},t}(egret.DisplayObjectContainer);__reflect(MyMovieClip.prototype,"MyMovieClip");var Share=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=this,t=ViewManager.getInstance().stage,i=Util.drawRoundRect(0,0,0,t.stageWidth,t.$stageHeight,0,.6);i.y=0,i.x=0,this.addChild(i);var n=Util.createBitmapByName("share_arrow");n.x=580,this.addChild(n);var a;"Android"==egret.Capabilities.os?(a=Util.createBitmapByName("share_tips_android"),a.width=t.stageWidth,a.height=.634*t.stageWidth):(a=Util.createBitmapByName("share_tips"),a.width=t.stageWidth,a.height=.876*t.stageWidth),a.y=t.stageHeight-a.height,this.addChild(a),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.parent.removeChild(e)},this)},t}(eui.Group);__reflect(Share.prototype,"Share");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){var e=ViewManager.getInstance().stage;this.width=e.stageWidth,this.height=e.stageHeight,this.textField=new egret.TextField,this.textField.width=400,this.textField.x=(this.width-this.textField.width)/2,this.textField.y=this.height-300,this.textField.textAlign="center",this.addChild(this.textField);var t=new MyMovieClip("loading_gif");t.x=(e.stageWidth-t.width)/2-35,t.y=this.height-400,this.addChild(t)},t.prototype.onProgress=function(e,t){this.textField.textFlow=[{text:" "+Math.ceil(e/t*100),style:{size:40}},{text:"%"}]},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var FriendHomeScene=function(e){function t(t,i){var n=e.call(this)||this;return n.userId=t,n.befeedId=i,n}return __extends(t,e),t.prototype.init=function(){var e=this;Http.getInstance().post(Url.HTTP_AROUND,{visitedId:this.befeedId},function(t){var i=new Head(t.data.visitInfo);e.head=i,e.addChild(i),i.food_list(t.data.visitInfo),e.vBaoInfo(t.data.visitedInfo),e.vBao(t.data.visitedInfo),e.present(t.data),e.goHome()})},t.prototype.vBaoInfo=function(e){var t=new eui.Group;this.addChild(t);var i=Util.drawRoundRect(0,0,0,260,230,10,.3);t.addChild(i),t.width=i.width,t.height=i.height,t.x=42,t.y=200;var n=1==e.kind_id?"小博士":2==e.kind_id?"小斗士":"小勇士",a=new egret.TextField;a.text=n,a.bold=!0,a.x=a.y=25,t.addChild(a);var r=new egret.TextField;r.textFlow=[{text:"名字："+e.nick_name},{text:"\n星座："+e.constellation},{text:"\n血型："+e.blood},{text:"\n爱好："+e.hobby}],r.x=a.x,r.y=80,r.lineSpacing=15,r.size=22,t.addChild(r)},t.prototype.vBao=function(e){var t=e.kind_id-1,i=1==e.level_id?880:780,n=new Bones(t,e.level_id,380,i);this.addChild(n)},t.prototype.present=function(e){var t=this,i=new BtnBase("present");i.x=180,i.y=this.stage.stageHeight-i.height-40,this.addChild(i);var n=new Alert("谢谢你的礼物！好吃又营养！");n.x=32,n.y=520,n.visible=!1,this.addChild(n);var a=new Alert("我喜欢的食材不够了呢，快通过每日任务和串门收集吧","left");a.x=this.stage.stageWidth-a.width-32,a.y=600,a.visible=!1,this.addChild(a);var r=JSON.parse(window.localStorage.getItem("foodList")),o=new GiftTip(r[e.visitInfo.kind_id-1].image);o.x=this.stage.stageWidth-o.width-50,o.y=600,o.visible=!1,this.addChild(o);var d=(new IndexScene).animate,s=r[e.visitInfo.food_type_id-1].num,h=r[e.visitedInfo.food_type_id-1].num,l=e.visitInfo.total_score;i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(h>0){var i=!1;Http.getInstance().get(Url.HTTP_GIFT,function(r){r.data.code&&(e.visitInfo.food_type_id==e.visitedInfo.food_type_id?i=!0:(s++,t.setFoodCount(e.visitInfo.food_type_id,s)),d(o)),Http.getInstance().post(Url.HTTP_FEED,{feedId:t.userId,befeedId:t.befeedId,type:6},function(r){if(1==r.data.code){i||h--,l++,t.setFoodCount(e.visitedInfo.food_type_id,h);var o=t.head.score;o.text="积分："+l,d(n)}else d(a)})})}else d(a)},this)},t.prototype.setFoodCount=function(e,t){var i=this.head.header_group.$children[e].$children[2];i.textFlow=[{text:"X",style:{size:20}},{text:"  "+t,style:{size:24}}]},t.prototype.goHome=function(){var e=new BtnBase("goHome");e.x=this.stage.stageWidth-e.width-180,e.y=this.stage.stageHeight-e.height-40,this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new IndexScene;ViewManager.getInstance().changeScene(e)},this)},t}(Scene);__reflect(FriendHomeScene.prototype,"FriendHomeScene");var GetVbaoScene=function(e){function t(t,i){var n=e.call(this)||this;return n.id=t,n.level=i,n}return __extends(t,e),t.prototype.init=function(){var e=this;if(1==this.level){var t=Util.createBitmapByName("getVbao_bg");t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,this.addChild(t)}else Http.getInstance().get(Url.HTTP_UPDATE,null);var i=new eui.Group;i.width=this.stage.stageWidth,i.height=this.stage.stageHeight,i.x=i.width/2,i.y=i.height/2,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,this.addChild(i);var n=Util.createBitmapByName("getVbao_"+VbaoType[this.id].name);n.x=this.center(n),n.y=330,i.addChild(n);var a=Util.createBitmapByName("getVbao_light");a.x=this.stage.stageWidth/2,a.y=a.height/2,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,i.addChild(a),egret.Tween.get(a,{loop:!0}).to({rotation:360},6e3);var r=new Bones(this.id,this.level,380,650);i.addChild(r);var o=Util.setTitle(VbaoType[this.id].label,90,VbaoType[this.id].color);o.x=this.center(o),o.y=872,i.addChild(o),egret.Tween.get(i).to({scaleX:0,scaleY:0},10).wait(100).to({scaleX:1,scaleY:1},800).call(function(){setTimeout(function(){var t=1==e.level?new InfoScene(e.id):new IndexScene;ViewManager.getInstance().changeScene(t)},3e3)});var d=1==this.level?"恭喜获得V宝!":"V宝进化啦!",s=Util.setTitle(d,60,VbaoType[this.id].color);s.x=this.center(s),s.y=206,this.addChild(s)},t}(Scene);__reflect(GetVbaoScene.prototype,"GetVbaoScene");var IndexScene=function(e){function t(){var t=e.call(this)||this;return t.currentIdx=1,t}return __extends(t,e),t.prototype.init=function(){var e=this;Http.getInstance().get(Url.HTTP_USER_INFO,function(t){if(e.userId=t.data.id,t.data.isUpdate){var i=new GetVbaoScene(t.data.kind_id-1,2);ViewManager.getInstance().changeScene(i)}else{var n=new Head(t.data);e.head=n,e.addChild(n),e.daily_task(t.data),e.vBao(t.data),2==t.data.level_id&&(n.food_list(t.data),e.legendary(),e.feed(t.data),e.decorate(),e.around())}onMenuShareAppMessage(e.userId,function(){e.removeChild(e.shareScene)}),onMenuShareTimeline(e.userId,function(){e.removeChild(e.shareScene)})})},t.prototype.daily_task=function(e){var t=this,i=new eui.Group;i.width=110,i.height=170,i.x=this.stage.stageWidth-i.width-30,i.y=206,this.addChild(i);var n=new BtnBase("daily_task_btn");n.x=i.width-n.width,n.y=i.height-n.height,i.addChild(n);var a=Util.createBitmapByName("daily_task_tips");a.x=0,a.y=0,a.visible=0==e.isfinish,i.addChild(a),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=new Task(e);t.addChild(i)},this)},t.prototype.legendary=function(){var e=new BtnBase("legendary");e.x=this.stage.stageWidth-e.width-30,e.y=380,this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Http.getInstance().get(Url.HTTP_LEGENDARY,function(e){location.href=e.data.content})},this)},t.prototype.vBao=function(e){var t=e.kind_id-1,i=2==e.level_id?780:880,n=new Bones(t,e.level_id,380,i);this.addChild(n);var a=new egret.TextField;a.text=e.nick_name,a.x=this.center(a),a.y=i+n.height/2,a.size=24,a.textColor=0,this.addChild(a)},t.prototype.feed=function(e){var t=this,i=new BtnBase("feed");i.x=110,i.y=this.stage.stageHeight-i.height-40,i.name="feed",this.addChild(i);var n=new Alert("谢谢主人！好吃又营养！");n.x=32,n.y=520,n.visible=!1,this.addChild(n);var a=new Alert("每日2次就够啦！明天请再来投喂V宝哦！");a.x=32,a.y=720,a.visible=!1,this.addChild(a);var r=new Alert("我喜欢的食材不够了呢，快通过每日任务和串门收集吧","left");r.x=this.stage.stageWidth-r.width-32,r.y=600,r.visible=!1,this.addChild(r);var o=e.total_score;i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=JSON.parse(window.localStorage.getItem("foodList")),d=i[e.food_type_id-1].num;d>0?Http.getInstance().post(Url.HTTP_FEED,{feedId:e.id,type:5},function(i){if(1==i.data.code){d--,o++;var r=t.head.header_group.$children[e.food_type_id].$children[2];r.textFlow=[{text:"X",style:{size:20}},{text:"  "+d,style:{size:24}}];var s=t.head.score;s.text="积分："+o,t.animate(n)}else t.animate(a)}):t.animate(r)},this)},t.prototype.animate=function(e){e.visible=!0,setTimeout(function(){e.visible=!1},2e3)},t.prototype.decorate=function(){var e=this,t=new BtnBase("decorate");t.x=510,t.y=this.stage.stageHeight-t.height-40,this.addChild(t);var i=new Alert("7月上新，敬请期待");i.x=325,i.y=this.stage.stageHeight-t.height-40-i.height,i.visible=!1,this.addChild(i),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.animate(i)},this)},t.prototype.around=function(){var e=this,t=new BtnBase("around");t.x=310,t.y=this.stage.stageHeight-t.height-40,t.name="around",this.addChild(t),this.showAround(),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.aroundGroup.visible=!0},this)},t.prototype.showAround=function(){var e=this,t=new eui.Group;t.visible=!1,this.aroundGroup=t,this.addChild(t);var i=Util.createBitmapByName("around_bg");t.width=i.width=this.stage.stageWidth,t.height=i.height,t.y=this.stage.stageHeight-t.height,t.addChild(i);var n=Util.setTitle("去串门",52,Config.COLOR_DOC);n.x=32,n.y=40,t.addChild(n);var a=new BtnBase("invite");a.x=this.stage.stageWidth-a.width-100,a.y=25,t.addChild(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new Share;e.shareScene=t,e.addChild(t)},this);var r=new BtnBase("around_close");r.x=this.stage.stageWidth-r.width-32,r.y=36,t.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.visible=!1},this),Http.getInstance().post(Url.HTTP_AROUNDLIST,{page:this.currentIdx,pageSize:10},function(i){e.aroundSize=i.data.length;var n=new eui.Group;e.friendList=n;var a=new eui.Scroller;a.width=e.stage.stageWidth,a.height=190,a.y=110,a.scrollPolicyV="false",a.viewport=n,t.addChild(a),a.addEventListener(eui.UIEvent.CHANGE_END,function(){a.viewport.scrollH+e.stage.stageWidth+100>a.viewport.contentWidth&&e.loadMoreData()},e),e.addItem(i.data)})},t.prototype.loadMoreData=function(){var e=this;10==this.aroundSize&&(this.currentIdx+=1,Http.getInstance().post(Url.HTTP_AROUNDLIST,{page:this.currentIdx,pageSize:10},function(t){e.aroundSize=t.data.length,e.addItem(t.data)}))},t.prototype.addItem=function(e){var t=this;e.forEach(function(e){var i="";i=e.serialNo<=3?"rank_0"+e.serialNo:"rank_04";var n=t.friendAvatar(e,i,e.serialNo);n.x=(e.serialNo-1)*(n.width+42)+42,n.y=45,t.friendList.addChild(n)})},t.prototype.friendAvatar=function(e,t,i){var n=this;if(e){var a=new eui.Group,r=new egret.Bitmap,o=Util.drawRoundRect(3,1389380,16777215,110,110,20);a.addChild(o),a.width=o.width,a.height=150,r.width=o.width-6,r.height=r.width,r.x=2,r.y=r.x;var d=new egret.ImageLoader;d.crossOrigin="anonymous",d.load(e.avatar),d.once(egret.Event.COMPLETE,function(n){if(n.currentTarget.data){var o=new egret.Texture;o._setBitmapData(n.currentTarget.data),r.texture=o,a.addChild(r);var d=Util.createBitmapByName(t);if(d.anchorOffsetX=d.width/2,d.anchorOffsetY=d.height/2,a.addChild(d),i>3){var s=new egret.TextField;s.text=i,s.width=d.width,s.height=d.height,s.anchorOffsetX=d.width/2,s.anchorOffsetY=d.height/2,s.textAlign="center",s.verticalAlign="middle",s.size=24,s.textColor=1389380,s.bold=!0,a.addChild(s)}var h=Util.drawRoundRect(0,0,0,107,26,0,.4);h.x=2,h.y=82,a.addChild(h);var l=new egret.TextField;l.text=e.name,l.width=a.width,l.height=h.height,l.y=h.y,l.textAlign="center",l.verticalAlign="middle",l.size=18,a.addChild(l)}},this);var s=new egret.TextField;return s.text="串门"+e.aroundCount+"次",s.y=a.height-s.height,s.width=a.width,s.textColor=Config.COLOR_DOC,s.textAlign="center",s.size=20,s.bold=!0,a.addChild(s),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.aroundGroup.visible=!1;var t=new FriendHomeScene(n.userId,e.id);ViewManager.getInstance().changeScene(t)},this),a}},t}(Scene);__reflect(IndexScene.prototype,"IndexScene");var InfoScene=function(e){function t(t){var i=e.call(this)||this;return i.propertyList=["nickName","constellation","blood","hobby"],i.id=t,i.property={kindId:i.id+1},i}return __extends(t,e),t.prototype.init=function(){var e=this,t=["名字","星座","血型","爱好"],i=Util.createBitmapByName("info_"+VbaoType[this.id].name);i.x=this.center(i),i.y=142,this.addChild(i);var n=new BtnBase("close");n.x=this.stage.stageWidth-n.width-70,n.y=165,this.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.getInstance().back(2)},this);var a=Util.setTitle(VbaoType[this.id].label,80,VbaoType[this.id].color);a.x=this.center(a),a.y=190,this.addChild(a);var r=new eui.Group;r.width=560,r.height=620,r.x=this.center(r),r.y=302,this.addChild(r);var o=Util.drawRoundRect(0,0,16777215,r.width,r.height,16);r.addChild(o);var d=45,s=new egret.TextField;s.text="你心中独一无二的V宝是什么样的呢？\n快点写下来！",s.x=s.y=d,s.textColor=VbaoType[this.id].color,r.addChild(s);for(var h=50,l=175,c=210,g=0;g<t.length;g++){var u=new egret.TextField;u.text=t[g],u.x=d,u.y=l,u.size=h,u.textColor=VbaoType[this.id].color,r.addChild(u);var p=Util.createBitmapByName("line");p.x=170,p.y=c,r.addChild(p);var f=new eui.EditableText;f.width=p.width,f.height=60,f.x=p.x,f.y=l-15,f.text="",f.textColor=VbaoType[this.id].color,f.size=40,f.textAlign="center",f.verticalAlign="middle",r.addChild(f),c+=110,l+=110,f.addEventListener(egret.Event.CHANGE,this.onChange(g),this)}var v=new BtnBase("btn_done");v.x=this.center(v),v.y=968,this.addChild(v),v.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.propertyList.every(function(t){return e.property.hasOwnProperty(t)});t&&Http.getInstance().post(Url.HTTP_USER_ADDBASEUSERINFO,e.property,function(e){if(1==e.data.code){var t=new IndexScene;ViewManager.getInstance().changeScene(t)}})},this)},t.prototype.onChange=function(e){var t=this;return function(i){t.property[t.propertyList[e]]=i.target.text}},t}(Scene);__reflect(InfoScene.prototype,"InfoScene");var KindScene=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){var e=new egret.Shape;e.graphics.beginFill(0,.6),e.graphics.drawRect(0,50,this.stage.stageWidth,150),e.graphics.endFill(),this.addChild(e);var t=new egret.TextField;t.text="V宝们完美地继承了Verzenios鲜明的品牌个性。你觉得下面哪一个个性最符合你心中的V宝呢？",t.x=50,t.y=80,t.width=this.stage.stageWidth-2*t.x,t.lineSpacing=26,this.addChild(t),this.showInfo()},t.prototype.showInfo=function(){var e=this,t=280;Http.getInstance().get(Url.HTTP_KIND_INFO,function(i){i.data.forEach(function(i,n){var a=new Vbao(i.description,VbaoType[n].color,n);a.x=e.center(a),a.y=t,e.addChild(a),t+=a.height+10})})},t}(Scene);__reflect(KindScene.prototype,"KindScene");var Vbao=function(e){function t(t,i,n){var a=e.call(this)||this;return a.init(t,i,n),a}return __extends(t,e),t.prototype.init=function(e,t,i){var n=new BtnBase("chooseVbao_"+VbaoType[i].name);this.width=n.width,this.height=n.height+30,this.addChild(n);var a=Util.setTitle(VbaoType[i].label,70,VbaoType[i].color);a.x=(this.width-a.width)/2,a.anchorOffsetY=30,this.addChild(a);var r=Util.drawRoundRect(0,16777215,16777215,430,150,20);r.x=r.y=44,this.addChild(r);var o=new egret.TextField;o.text=e,o.textColor=t,o.x=75,o.y=75,o.size=24,o.width=360,o.lineSpacing=15,this.addChild(o);var d=Util.setTitle("就是你啦",30,VbaoType[i].color);d.x=this.width-d.width-35,d.y=98,this.addChild(d),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new GetVbaoScene(i,1);ViewManager.getInstance().changeScene(e)},this)},t}(eui.Group);__reflect(Vbao.prototype,"Vbao");var Config=function(){function e(){}return e.COLOR_DOC=1727099,e.COLOR_PILOT=9643081,e.COLOR_BOX=6562963,e.HOST=window.localStorage.getItem("host"),e}();__reflect(Config.prototype,"Config");var VbaoType=[{name:"doc",color:Config.COLOR_DOC,label:"准"},{name:"pilot",color:Config.COLOR_PILOT,label:"敢"},{name:"box",color:Config.COLOR_BOX,label:"韧"}],WishScene=function(e){function t(t){var i=e.call(this)||this;return i.item=t,i}return __extends(t,e),t.prototype.init=function(){var e=this,t=Util.createBitmapByName("info_doc");t.width=670,t.height=725,t.x=this.center(t),t.y=290,this.addChild(t);var i=Util.setTitle("V宝正闭着眼睛竖起耳朵听你的祝福。\n你想对他/她说什么呢？",36,Config.COLOR_DOC);i.x=this.center(i),i.y=345,i.textAlign="center",i.lineSpacing=6,this.addChild(i);var n=Util.drawRoundRect(0,0,16777215,560,360,20);n.x=this.center(n),n.y=455,this.addChild(n);var a=new egret.TextField;a.type=egret.TextFieldType.INPUT,a.width=n.width-60,a.height=n.height-40,a.x=n.x+30,a.y=n.y+20,a.textColor=Config.COLOR_DOC,a.multiline=!0,this.addChild(a);var r=new egret.TextField;r.text="请输入你的祝福...",r.textColor=Config.COLOR_DOC,r.size=24,r.x=a.x,r.y=a.y,this.addChild(r),a.addEventListener(egret.Event.FOCUS_IN,function(){r.visible=!1},this);var o="";a.addEventListener(egret.Event.CHANGE,function(e){o=e.target.text},this);var d=new BtnBase("btn_wish");d.x=this.center(d),d.y=860,d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o&&(Http.getInstance().post(Url.HTTP_TASK_FINISHTASK,{taskId:e.item.id,score:e.item.score},function(e){if(e.data.code){var t=new IndexScene;ViewManager.getInstance().changeScene(t)}}),Http.getInstance().post(Url.HTTP_SENDINFO,{content:o},null))},this),this.addChild(d)},t}(Scene);__reflect(WishScene.prototype,"WishScene");var Http=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.httpRequest=function(e,t,i,n){e=Config.HOST+e;var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(e,t),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var r=Util.urlEncode(n,null).slice(1);return a.send(r),a.addEventListener(egret.Event.COMPLETE,this.onComplete(i),this),a},e.prototype.get=function(e,t){this.httpRequest(e,egret.HttpMethod.GET,t)},e.prototype.post=function(e,t,i){this.httpRequest(e,egret.HttpMethod.POST,i,t)},e.prototype.onComplete=function(e){return function(t){var i=t.currentTarget,n=JSON.parse(i.response);e&&e(n)}},e}();__reflect(Http.prototype,"Http");var Url=function(){function e(){}return e.HTTP_USER_INFO="/game/api/user/info",e.HTTP_KIND_INFO="/game/api/kind/kindInfo",e.HTTP_USER_ADDBASEUSERINFO="/game/api/user/addBaseUserInfo",e.HTTP_TASK_TASKLIST="/game/api/task/taskList",e.HTTP_TASK_FINISHTASK="/game/api/task/finishTask",e.HTTP_SENDINFO="/game/api/sendinfo/sendInfo",e.HTTP_LEGENDARY="/game/api/vresource/findVideo",e.HTTP_FEED="/game/api/around/addfoodLog",e.HTTP_USER_SIGN="/game/api/user/userSign",e.HTTP_AROUNDLIST="/game/api/user/findAroundCount",e.HTTP_AROUND="/game/api/around/around",e.HTTP_GIFT="/game/api/around/sunRandom",e.HTTP_UPDATE="/game/api/task/isUpdate",e
}();__reflect(Url.prototype,"Url");var Util=function(){function e(){}return e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.drawRoundRect=function(e,t,i,n,a,r,o){void 0===o&&(o=1);var d=new egret.Shape;return d.graphics.lineStyle(e,t),d.graphics.beginFill(i,o),d.graphics.drawRoundRect(0,0,n,a,r,r),d.graphics.endFill(),d},e.urlEncode=function(e,t){if(null==e)return"";var i="",n=typeof e;if("string"==n||"number"==n||"boolean"==n)i+="&"+t+"="+e;else for(var a in e){var r=null==t?a:t+(e instanceof Array?"["+a+"]":"."+a);i+=this.urlEncode(e[a],r)}return i},e.setAvatar=function(e){if(e){var t=new eui.Group,i=new egret.Bitmap,n=25,a=this.createBitmapByName("avatar_bg");t.addChild(a),t.width=a.width,t.height=a.height,i.x=n,i.y=n,i.width=a.width-2*n,i.height=a.height-2*n;var r=new egret.ImageLoader;return r.crossOrigin="anonymous",r.load(e),r.once(egret.Event.COMPLETE,function(e){if(e.currentTarget.data){var n=new egret.Texture;n._setBitmapData(e.currentTarget.data),i.texture=n,t.addChild(i)}},this),t}},e.setTitle=function(e,t,i,n){void 0===n&&(n=2);var a=new egret.TextField;return a.text=e,a.size=t,a.strokeColor=i,a.stroke=n,a},e}();__reflect(Util.prototype,"Util");